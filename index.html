<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Captain Sapimu - API Documentation</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0f1a;--bg2:#111827;--bg3:#1a2332;--border:#1e293b;--accent:#3b82f6;--accent2:#60a5fa;--green:#10b981;--yellow:#f59e0b;--red:#ef4444;--purple:#8b5cf6;--text:#e2e8f0;--text2:#94a3b8;--text3:#64748b;--sidebar-w:280px}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;overflow-x:hidden}
.sidebar{position:fixed;top:0;left:0;width:var(--sidebar-w);height:100vh;background:var(--bg2);border-right:1px solid var(--border);overflow-y:auto;z-index:100;transition:transform .3s}
.sidebar-header{padding:20px;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--bg2);z-index:10}
.sidebar-header h1{font-size:18px;background:linear-gradient(135deg,var(--accent),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:4px}
.sidebar-header p{font-size:11px;color:var(--text3)}
.sidebar-search{padding:12px 16px;border-bottom:1px solid var(--border);position:sticky;top:80px;background:var(--bg2);z-index:10}
.sidebar-search input{width:100%;padding:8px 12px;background:var(--bg3);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:13px;outline:none}
.sidebar-search input:focus{border-color:var(--accent)}
.sidebar-search input::placeholder{color:var(--text3)}
.sidebar-stats{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;gap:8px}
.stat-badge{flex:1;text-align:center;padding:6px;background:var(--bg3);border-radius:6px}
.stat-badge .num{font-size:16px;font-weight:700;color:var(--accent2)}
.stat-badge .label{font-size:9px;color:var(--text3);text-transform:uppercase}
.sidebar-nav{padding:8px 0}
.nav-item{display:flex;align-items:center;padding:8px 16px;cursor:pointer;transition:all .15s;border-left:3px solid transparent;gap:10px}
.nav-item:hover{background:var(--bg3)}
.nav-item.active{background:rgba(59,130,246,.1);border-left-color:var(--accent)}
.nav-item .nav-icon{width:28px;height:28px;border-radius:6px;background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--accent2)}
.nav-item .nav-name{font-size:13px;font-weight:500;flex:1}
.nav-item .nav-count{font-size:11px;color:var(--text3);background:var(--bg);padding:2px 6px;border-radius:10px}
.nav-item .nav-status{font-size:9px;margin-left:4px}
.main{margin-left:var(--sidebar-w);min-height:100vh}
.hero{padding:60px 40px 40px;background:linear-gradient(180deg,rgba(59,130,246,.08) 0%,transparent 100%);border-bottom:1px solid var(--border)}
.hero h1{font-size:36px;font-weight:800;margin-bottom:12px}
.hero h1 span{background:linear-gradient(135deg,var(--accent),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{color:var(--text2);font-size:16px;max-width:600px;margin-bottom:24px}
.hero-badges{display:flex;gap:12px;flex-wrap:wrap}
.hero-badge{padding:6px 14px;background:var(--bg3);border:1px solid var(--border);border-radius:20px;font-size:12px;color:var(--text2)}
.hero-badge strong{color:var(--accent2)}
.loading-bar{position:fixed;top:0;left:var(--sidebar-w);right:0;height:3px;background:var(--bg3);z-index:200;display:none}
.loading-bar.show{display:block}
.loading-bar .progress{height:100%;background:linear-gradient(90deg,var(--accent),var(--purple));transition:width .3s;width:0}
.auth-section{padding:24px 40px;background:var(--bg2);border-bottom:1px solid var(--border)}
.auth-box{background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:16px 20px;max-width:700px}
.auth-box h3{font-size:14px;color:var(--yellow);margin-bottom:8px}
.token-row{display:flex;gap:8px;margin-bottom:6px}
.token-row input{flex:1;padding:8px 12px;background:var(--bg);border:1px solid var(--border);border-radius:6px;font-family:'Fira Code',monospace;font-size:12px;color:var(--green);outline:none}
.token-row button{padding:8px 14px;border:none;border-radius:6px;cursor:pointer;font-size:12px;font-weight:600;background:var(--accent);color:#fff}
.token-status{font-size:11px;display:flex;align-items:center;gap:6px}
.token-dot{width:8px;height:8px;border-radius:50%}
.token-dot.active{background:var(--green)}
.token-dot.inactive{background:var(--red)}
.prefetch-status{margin-top:10px;padding:8px 12px;background:var(--bg);border-radius:6px;font-size:11px;color:var(--text3)}
.prefetch-status.loading{color:var(--yellow)}
.prefetch-status.done{color:var(--green)}
.prefetch-status.error{color:var(--red)}
.content{padding:30px 40px}
.platform-section{margin-bottom:50px;scroll-margin-top:20px}
.platform-header{display:flex;align-items:center;gap:16px;margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid var(--border)}
.platform-icon{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--purple));display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:800;color:#fff}
.platform-header h2{font-size:24px;font-weight:700}
.platform-header .platform-meta{font-size:12px;color:var(--text3)}
.platform-header .platform-meta code{background:var(--bg3);padding:2px 6px;border-radius:4px;color:var(--accent2)}
.endpoint-card{background:var(--bg2);border:1px solid var(--border);border-radius:8px;margin-bottom:10px;overflow:hidden;transition:border-color .2s}
.endpoint-card:hover{border-color:var(--accent)}
.endpoint-header{display:flex;align-items:center;padding:12px 16px;gap:12px;cursor:pointer;user-select:none}
.method-badge{padding:4px 10px;border-radius:4px;font-size:11px;font-weight:700;font-family:monospace;min-width:50px;text-align:center}
.method-GET{background:rgba(16,185,129,.15);color:var(--green);border:1px solid rgba(16,185,129,.3)}
.method-POST{background:rgba(59,130,246,.15);color:var(--accent2);border:1px solid rgba(59,130,246,.3)}
.endpoint-path{font-family:'Fira Code',monospace;font-size:13px;color:var(--text);flex:1}
.endpoint-path .param{color:var(--yellow)}
.endpoint-desc{font-size:12px;color:var(--text3);max-width:300px;text-align:right}
.endpoint-toggle{color:var(--text3);font-size:12px;transition:transform .2s}
.endpoint-card.open .endpoint-toggle{transform:rotate(180deg)}
.endpoint-detail{display:none;padding:0 16px 16px;border-top:1px solid var(--border)}
.endpoint-card.open .endpoint-detail{display:block}
.detail-section{margin-top:12px}
.detail-section h4{font-size:11px;text-transform:uppercase;color:var(--text3);margin-bottom:8px}
.param-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;padding:12px;background:var(--bg);border-radius:6px;border:1px solid var(--border)}
.param-item{display:flex;flex-direction:column;gap:4px}
.param-item label{font-size:10px;color:var(--yellow);font-weight:600;text-transform:uppercase}
.param-item label .req{color:var(--red)}
.param-item label .opt{color:var(--text3);font-weight:400}
.param-item input,.param-item select{padding:8px 10px;background:var(--bg3);border:1px solid var(--border);border-radius:4px;color:var(--text);font-family:monospace;font-size:12px;outline:none;width:100%}
.param-item input:focus,.param-item select:focus{border-color:var(--yellow)}
.param-item select{cursor:pointer}
.param-item select.loaded{border-color:var(--green)}
.page-ctrl{display:flex;align-items:center;gap:4px}
.page-ctrl input{width:50px;text-align:center}
.page-ctrl button{width:26px;height:26px;border:1px solid var(--border);background:var(--bg3);color:var(--text);border-radius:4px;cursor:pointer;font-size:14px}
.page-ctrl button:hover{background:var(--border)}
.try-section{margin-top:12px;padding:12px;background:var(--bg);border-radius:6px;border:1px solid var(--border)}
.try-url{display:flex;gap:8px}
.try-url input{flex:1;padding:8px 12px;background:var(--bg3);border:1px solid var(--border);border-radius:6px;color:var(--text);font-family:monospace;font-size:12px;outline:none}
.try-url button{padding:8px 14px;border:none;border-radius:6px;cursor:pointer;font-size:12px;font-weight:600}
.btn-send{background:var(--accent);color:#fff}
.btn-send:hover{background:var(--accent2)}
.btn-copy{background:var(--bg3);color:var(--text2);border:1px solid var(--border)!important}
.response-box{margin-top:10px;background:var(--bg2);border:1px solid var(--border);border-radius:6px;overflow:hidden;display:none}
.response-header{display:flex;justify-content:space-between;padding:8px 12px;background:var(--bg3);border-bottom:1px solid var(--border);font-size:11px;align-items:center}
.response-status{font-weight:700}
.response-status.ok{color:var(--green)}
.response-status.err{color:var(--red)}
.response-status.loading{color:var(--yellow)}
.response-body{padding:12px;font-family:'Fira Code',monospace;font-size:11px;max-height:400px;overflow-y:auto;white-space:pre-wrap;word-break:break-all;color:var(--text2)}
.response-actions button{background:var(--bg);border:1px solid var(--border);color:var(--text3);padding:2px 8px;border-radius:4px;cursor:pointer;font-size:10px;margin-left:4px}
.mobile-toggle{display:none;position:fixed;top:12px;left:12px;z-index:200;width:40px;height:40px;background:var(--accent);border:none;border-radius:8px;color:#fff;font-size:18px;cursor:pointer}
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:99}
.overlay.show{display:block}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
@media(max-width:768px){.sidebar{transform:translateX(-100%)}.sidebar.open{transform:translateX(0)}.main{margin-left:0}.mobile-toggle{display:flex;align-items:center;justify-content:center}.hero{padding:70px 20px 30px}.hero h1{font-size:24px}.auth-section{padding:16px 20px}.content{padding:20px}.endpoint-desc{display:none}.param-grid{grid-template-columns:1fr 1fr}.loading-bar{left:0}}
</style>
</head>
<body>
<div class="loading-bar" id="loadingBar"><div class="progress" id="loadingProgress"></div></div>
<button class="mobile-toggle" onclick="toggleSidebar()">‚ò∞</button>
<div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
<aside class="sidebar" id="sidebar">
<div class="sidebar-header"><h1>üé¨ Captain Sapimu</h1><p>API Documentation v1.0</p></div>
<div class="sidebar-search"><input type="text" id="searchInput" placeholder="Search platform..." oninput="filterPlatforms()"></div>
<div class="sidebar-stats"><div class="stat-badge"><div class="num" id="statPlatforms">42</div><div class="label">Platforms</div></div><div class="stat-badge"><div class="num" id="statEndpoints">0</div><div class="label">Endpoints</div></div></div>
<nav class="sidebar-nav" id="sidebarNav"></nav>
</aside>
<div class="main">
<div class="hero"><h1>üé¨ <span>Captain Sapimu</span> API</h1><p>42 platform short drama dengan IDs pre-loaded untuk instant access!</p><div class="hero-badges"><div class="hero-badge"><strong id="badgePlatforms">42</strong> Platforms</div><div class="hero-badge"><strong id="badgeEndpoints">0</strong> Endpoints</div><div class="hero-badge"><strong>‚ö° Simple</strong> Proxy</div><div class="hero-badge"><strong>Error-free</strong></div></div></div>
<div class="auth-section"><div class="auth-box"><h3>üîê Authentication</h3><div class="token-row"><input type="text" id="tokenInput" placeholder="Paste token..."><button onclick="saveToken()">üíæ Save & Load IDs</button></div><div class="token-status"><span class="token-dot active" id="tokenDot"></span><span id="tokenStatusText" style="color:var(--green)">Token ready</span></div><div class="prefetch-status done" id="prefetchStatus">‚úÖ Proxy working! Click Load IDs to test platforms</div></div></div>
<div class="content" id="content"></div>
</div>

<script>
// Fixed proxy function
function proxyFetch(path, token) {
  return fetch('/api/proxy?path=' + encodeURIComponent(path), { 
    headers: { 'Authorization': 'Bearer ' + token },
    method: 'GET'
  });
}

// Default token
var TOKEN_DEFAULT = "53d25de32c37b0fcd2b14a9f834050493cc044d5039b5aff3283da73a8ef761b";
var CACHE_KEY = "sapimu_cache_v11";

var cache = { ids: {} };
var failedPlatforms = [];

function loadCache() { 
  try { 
    var s = localStorage.getItem(CACHE_KEY); 
    if (s) cache = JSON.parse(s); 
  } catch(e) {} 
}

function saveCache() { 
  try { 
    localStorage.setItem(CACHE_KEY, JSON.stringify(cache)); 
  } catch(e) {} 
}

// Simplified platform config (top 10 for testing)
var P = {
  dramadash: {n:"DramaDash", l:"/home", id:"id", t:"name", pa:"data.banner", ep:[
    {m:"GET", p:"/home", d:"Home", ty:"list"},
    {m:"GET", p:"/drama/:id", d:"Detail", ty:"detail", pr:{id:1}}
  ]},
  reelshort: {n:"ReelShort", l:"/api/v1/foryou", id:"id", t:"name", pa:"data.hall_list", ep:[
    {m:"GET", p:"/api/v1/foryou", d:"For You", ty:"list"},
    {m:"GET", p:"/api/v1/book/:id", d:"Detail", ty:"detail", pr:{id:1}}
  ]},
  dramabox: {n:"DramaBox", l:"/api/v1/foryou/1", id:"book_id", t:"name", pa:"data.list", ep:[
    {m:"GET", p:"/api/v1/foryou/1", d:"For You", ty:"list"},
    {m:"GET", p:"/api/v1/chapters/:bookId", d:"Chapters", ty:"list", pr:{bookId:1}}
  ]}
};

function getToken() { 
  return document.getElementById('tokenInput').value || TOKEN_DEFAULT; 
}

function saveToken() {
  var t = document.getElementById('tokenInput').value.trim() || TOKEN_DEFAULT;
  document.getElementById('tokenInput').value = t;
  localStorage.setItem('sapimu_token', t);
  document.getElementById('tokenStatusText').textContent = 'Token saved!';
  loadIds();
}

function loadToken() {
  var t = localStorage.getItem('sapimu_token') || TOKEN_DEFAULT;
  document.getElementById('tokenInput').value = t;
}

// Test basic functionality
async function loadIds() {
  document.getElementById('prefetchStatus').className = 'prefetch-status loading';
  document.getElementById('prefetchStatus').textContent = 'Testing platforms...';
  
  var token = getToken();
  var success = 0;
  
  for (var k in P) {
    try {
      var path = k + P[k].l;
      var r = await proxyFetch(path, token);
      if (r.ok) success++;
    } catch(e) {}
  }
  
  if (success > 0) {
    document.getElementById('prefetchStatus').className = 'prefetch-status done';
    document.getElementById('prefetchStatus').textContent = `‚úÖ ${success}/${Object.keys(P).length} platforms working!`;
  } else {
    document.getElementById('prefetchStatus').className = 'prefetch-status error';
    document.getElementById('prefetchStatus').textContent = '‚ùå Connection failed. Check proxy.';
  }
}

function renderSidebar() {
  var nav = document.getElementById('sidebarNav');
  nav.innerHTML = Object.entries(P).map(([k, p]) => 
    `<div class="nav-item" data-key="${k}" onclick="scrollTo('${k}')">
      <div class="nav-icon">${p.n.slice(0,2)}</div>
      <div class="nav-name">${p.n}</div>
      <div class="nav-count">${p.ep.length}</div>
    </div>`
  ).join('');
}

function renderContent() {
  var c = document.getElementById('content');
  c.innerHTML = Object.entries(P).map(([k, pl]) => {
    var eps = pl.ep.map((ep, i) => 
      `<div class="endpoint-card" id="${k}-${i}">
        <div class="endpoint-header" onclick="toggle('${k}-${i}')">
          <span class="method-badge method-${ep.m}">${ep.m}</span>
          <span class="endpoint-path">${ep.p}</span>
          <span class="endpoint-desc">${ep.d}</span>
          <span class="endpoint-toggle">v</span>
        </div>
        <div class="endpoint-detail">
          <div class="try-section">
            <div class="try-url">
              <input type="text" value="/api/proxy?path=${encodeURIComponent(k + ep.p)}" readonly>
              <button class="btn-copy" onclick="copy(this)">Copy</button>
              <button class="btn-send" onclick="send('${k}', ${i})">Send</button>
            </div>
            <div class="response-box" id="resp-${k}-${i}" style="display:none">
              <div class="response-header">
                <span class="response-status" id="rs-${k}-${i}"></span>
                <button onclick="this.parentElement.parentElement.style.display='none'">√ó</button>
              </div>
              <pre class="response-body" id="rb-${k}-${i}"></pre>
            </div>
          </div>
        </div>
      </div>`
    ).join('');
    
    return `<div class="platform-section" id="p-${k}">
      <div class="platform-header">
        <div class="platform-icon">${pl.n.slice(0,2)}</div>
        <div><h2>${pl.n}</h2></div>
      </div>
      ${eps}
    </div>`;
  }).join('');
}

function toggle(id) { 
  document.getElementById(id).classList.toggle('open'); 
}

function scrollTo(k) { 
  document.getElementById('p-'+k).scrollIntoView({behavior:'smooth'}); 
}

function copy(btn) { 
  var input = btn.previousElementSibling;
  navigator.clipboard.writeText(input.value);
  btn.textContent = 'Copied!';
  setTimeout(() => btn.textContent = 'Copy', 1000);
}

async function send(k, i) {
  var token = getToken();
  var ep = P[k].ep[i];
  var path = k + ep.p;
  
  var box = document.getElementById(`resp-${k}-${i}`);
  var status = document.getElementById(`rs-${k}-${i}`);
  var body = document.getElementById(`rb-${k}-${i}`);
  
  box.style.display = 'block';
  status.textContent = 'Loading...';
  status.className = 'response-status loading';
  
  try {
    var r = await proxyFetch(path, token);
    var data = await r.json();
    
    status.textContent = r.status + ' ' + r.statusText;
    status.className = 'response-status ' + (r.ok ? 'ok' : 'err');
    body.textContent = JSON.stringify(data, null, 2);
  } catch(e) {
    status.textContent = 'Error';
    status.className = 'response-status err';
    body.textContent = e.message;
  }
}

function filterPlatforms() {
  var q = document.getElementById('searchInput').value.toLowerCase();
  document.querySelectorAll('.nav-item').forEach(n => {
    n.style.display = n.querySelector('.nav-name').textContent.toLowerCase().includes(q) ? 'flex' : 'none';
  });
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('overlay').classList.toggle('show');
}

// Initialize
document.getElementById('statPlatforms').textContent = Object.keys(P).length;
document.getElementById('statEndpoints').textContent = Object.values(P).reduce((a,p) => a + p.ep.length, 0);

loadCache();
renderSidebar();
renderContent();
loadToken();

// Test proxy on load
setTimeout(async () => {
  try {
    var r = await fetch('/api/proxy');
    var data = await r.json();
    if (data.status === 'ok') {
      document.getElementById('prefetchStatus').textContent = '‚úÖ Proxy online! Ready to test';
    }
  } catch(e) {
    document.getElementById('prefetchStatus').className = 'prefetch-status error';
    document.getElementById('prefetchStatus').textContent = '‚ùå Proxy offline';
  }
}, 1000);
</script>
</body>
</html>
